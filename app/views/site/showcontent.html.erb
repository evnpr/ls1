
  <style type="text/css" media="screen">
    #editor { 
        position: relative;
        margin: 0 100;
        width: 100%;
        height: 500px;
    }
  </style>



<br>
<div id="name" class="row-fluid">
<span class="span1"><a href=<%= "'/list/?r=#{@back}'"%> style="cursor:pointer">
<i class="icon-arrow-left"></i>
</a></span>
<% if !request.GET['vim'].nil? then %>
<span class="span1 offset10" style="float:right"><a href=<%="'/content?r=#{@r}'" %>><button class="btn">normal</button></a></span>
<br>
<% else %>
<span class="span1 offset10" style="float:right"><a href=<%="'/content?r=#{@r}&vim=1'" %>><button class="btn">Vim</button></a></span>
<% end %>
</div>

<code class="" style="float:left"><%= @path %></code>
<% if !request.GET['vim'].nil? %>
<br>
<code style="float:right">press <b>:w</b> or <b>:q</b> to save and push your change</code>
<% end %>
<br>
<br>
<% if !request.GET['vim'].nil? then %>
<br>
<iframe src="/ace-editor/vim?r=<%= @r %>" frameborder="0" width="100%" height="400px"></iframe>
<% else %>
<br>
<pre id="editor">
<%= @contents %>
</pre>

<span id="thisfile" style="display: none" value="<%= @r %>"><%= @r %></span>



<% end %>


<% if request.GET['vim'].nil? then %>
<div class="row-fluid" style="margin-top: 30px;">

<div class="span2">
    <button class="btn btn-large btn-inverse" onClick="save()">Save</button>
</div>

<div class="offset4 span2">
    <form action="/site/githubpull" method="post">
    <input type="hidden" name="l" value="<%= @apps_name %>" />
    <input type="hidden" name="r" value="<%= "#{request.protocol}#{request.host_with_port}#{request.fullpath}" %>" />
    <p><input type="submit" value="pull from github" class="btn btn-large btn-info"></p>
    </form>
</div>

<div class="span1">
    <form action="/site/github" method="post" accept-charset="utf-8">
    <input type="hidden" name="r" value="<%= @r %>" />
    <p><input type="submit" value="push github" class="btn btn-danger btn-large"></p>
    </form>
</div>

    <div id="name" class="offset6 span2" style="float: right">
       <a href="http://apps.letspan.com/<%= @apps_name %>"><button class="btn btn-primary btn-large">Go View App</button></a> 
    </div>



</div>
<% end %>




<div id="name" class="row-fluid" style="display: none">


<div id="name" style="float:left">
<form action="/site/bitbucketpull" method="post">
<input type="hidden" name="l" value="<%= @apps_name %>" />
<input type="hidden" name="r" value="<%= "#{request.protocol}#{request.host_with_port}#{request.fullpath}" %>" />
<p><input type="submit" value="pull from bitbucket" class="btn btn-large btn-info"></p>
</form>
    <div id="name" class="" style="float:left">
<form action="/site/bitbucket" method="post" accept-charset="utf-8">
<input type="hidden" name="r" value="<%= @r %>" />
<p><input type="submit" value="push bitbucket" class="btn btn-danger btn-large"></p>
</form>
        
    </div>
</div>

</div>

<script src="src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    editor.getSession().setMode("ace/mode/<%= @language %>");

    function save(){
        var commit = prompt("Commit: ", "just edit <%= @path %>");
        var content = editor.getSession().getValue();
        thisfile = document.getElementById("thisfile").innerHTML
        $.post('/site/savecontent', { content: content, thisfile: thisfile, commit: commit });
    }

</script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>

